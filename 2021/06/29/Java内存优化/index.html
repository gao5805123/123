<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Java内存优化 | 123</title><meta name="description" content="Java代码中的内存泄漏1231.内存泄漏的原因是对象上有强引用2.虽然Java程序运行完后,内存会回收,但应让对象尽早被回收3.出现内存泄漏后,会导致Stop The World和OOM异常 finalize方法1231.Object类中的方法,任何类都可以重写该方法2.当JVM通过根可达算法,判断某对象可以被回收后,会判断该类是否重写了finalize方法,如果没有,将直接回收;如果重写了fi"><meta name="keywords" content="Java"><meta name="author" content="123"><meta name="copyright" content="123"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/123/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Java内存优化"><meta name="twitter:description" content="Java代码中的内存泄漏1231.内存泄漏的原因是对象上有强引用2.虽然Java程序运行完后,内存会回收,但应让对象尽早被回收3.出现内存泄漏后,会导致Stop The World和OOM异常 finalize方法1231.Object类中的方法,任何类都可以重写该方法2.当JVM通过根可达算法,判断某对象可以被回收后,会判断该类是否重写了finalize方法,如果没有,将直接回收;如果重写了fi"><meta name="twitter:image" content="https://img-blog.csdnimg.cn/20210629111236388.png"><meta property="og:type" content="article"><meta property="og:title" content="Java内存优化"><meta property="og:url" content="https://gao5805123.github.io/123/2021/06/29/Java%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96/"><meta property="og:site_name" content="123"><meta property="og:description" content="Java代码中的内存泄漏1231.内存泄漏的原因是对象上有强引用2.虽然Java程序运行完后,内存会回收,但应让对象尽早被回收3.出现内存泄漏后,会导致Stop The World和OOM异常 finalize方法1231.Object类中的方法,任何类都可以重写该方法2.当JVM通过根可达算法,判断某对象可以被回收后,会判断该类是否重写了finalize方法,如果没有,将直接回收;如果重写了fi"><meta property="og:image" content="https://img-blog.csdnimg.cn/20210629111236388.png"><meta property="article:published_time" content="2021-06-29T03:09:30.000Z"><meta property="article:modified_time" content="2021-06-29T03:13:29.811Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/123/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://gao5805123.github.io/123/2021/06/29/Java%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96/"><link rel="prev" title="定位和排查OOM流程" href="https://gao5805123.github.io/123/2021/06/29/%E5%AE%9A%E4%BD%8D%E5%92%8C%E6%8E%92%E6%9F%A5OOM%E6%B5%81%E7%A8%8B/"><link rel="next" title="ConcurrentHashMap" href="https://gao5805123.github.io/123/2021/06/29/ConcurrentHashMap/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/123/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: {"text":"123,邪丶魔狱","fontSize":"15px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="google-site-verification" content="pfcRZO1Gb4pmhedTsfidXjiu4Q25HFYON7GMwAXxEYQ" /><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/123/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/123/archives/"><div class="headline">文章</div><div class="length_num">189</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/123/tags/"><div class="headline">标签</div><div class="length_num">12</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/123/categories/"><div class="headline">分类</div><div class="length_num">12</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/123/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/123/archives/"><i class="fa-fw fa fa-archive"></i><span> 档案</span></a></div><div class="menus_item"><a class="site-page" href="/123/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/123/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/123/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/123/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/123/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Java代码中的内存泄漏"><span class="toc-number">1.</span> <span class="toc-text">Java代码中的内存泄漏</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#finalize方法"><span class="toc-number">2.</span> <span class="toc-text">finalize方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#代码展示"><span class="toc-number">2.1.</span> <span class="toc-text">代码展示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#打印展示"><span class="toc-number">2.2.</span> <span class="toc-text">打印展示</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#String"><span class="toc-number">3.</span> <span class="toc-text">String</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#观察String的不可变特性"><span class="toc-number">3.1.</span> <span class="toc-text">观察String的不可变特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#代码展示-1"><span class="toc-number">3.1.1.</span> <span class="toc-text">代码展示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#图片展示"><span class="toc-number">3.1.2.</span> <span class="toc-text">图片展示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通过String观察常量和变量"><span class="toc-number">3.2.</span> <span class="toc-text">通过String观察常量和变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#代码展示-2"><span class="toc-number">3.2.1.</span> <span class="toc-text">代码展示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#打印展示-1"><span class="toc-number">3.2.2.</span> <span class="toc-text">打印展示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常量与变量的存储位置"><span class="toc-number">3.3.</span> <span class="toc-text">常量与变量的存储位置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#虚拟机结构"><span class="toc-number">4.</span> <span class="toc-text">虚拟机结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#垃圾回收时的分代管理"><span class="toc-number">5.</span> <span class="toc-text">垃圾回收时的分代管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#内存回收流程"><span class="toc-number">5.1.</span> <span class="toc-text">内存回收流程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Minor-GC和Full-GC"><span class="toc-number">6.</span> <span class="toc-text">Minor GC和Full GC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#判断对象可以被回收的标准"><span class="toc-number">6.1.</span> <span class="toc-text">判断对象可以被回收的标准</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#可作为根可达算法的对象"><span class="toc-number">6.2.</span> <span class="toc-text">可作为根可达算法的对象</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#强引用、弱引用、软引用"><span class="toc-number">7.</span> <span class="toc-text">强引用、弱引用、软引用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#定义强引用、软引用和弱引用的方式"><span class="toc-number">7.1.</span> <span class="toc-text">定义强引用、软引用和弱引用的方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#软引用和弱引用的回收时机"><span class="toc-number">7.2.</span> <span class="toc-text">软引用和弱引用的回收时机</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#代码展示-3"><span class="toc-number">7.2.1.</span> <span class="toc-text">代码展示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WeakHashMap"><span class="toc-number">7.3.</span> <span class="toc-text">WeakHashMap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#打印展示-2"><span class="toc-number">7.3.1.</span> <span class="toc-text">打印展示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码展示-4"><span class="toc-number">7.3.2.</span> <span class="toc-text">代码展示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#打印展示-3"><span class="toc-number">7.3.3.</span> <span class="toc-text">打印展示</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#内部匿名类形参"><span class="toc-number">8.</span> <span class="toc-text">内部匿名类形参</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JDK1-7及之前版本"><span class="toc-number">8.1.</span> <span class="toc-text">JDK1.7及之前版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JDK1-8版本"><span class="toc-number">8.2.</span> <span class="toc-text">JDK1.8版本</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#优化措施"><span class="toc-number">9.</span> <span class="toc-text">优化措施</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#代码中的优化措施"><span class="toc-number">9.1.</span> <span class="toc-text">代码中的优化措施</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#命令的优化措施"><span class="toc-number">9.2.</span> <span class="toc-text">命令的优化措施</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://img-blog.csdnimg.cn/20210629111236388.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/123/">123</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/123/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/123/archives/"><i class="fa-fw fa fa-archive"></i><span> 档案</span></a></div><div class="menus_item"><a class="site-page" href="/123/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/123/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/123/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/123/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/123/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Java内存优化</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2021-06-29 11:09:30"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2021-06-29</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2021-06-29 11:13:29"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2021-06-29</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/123/categories/Java/">Java</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h1 id="Java代码中的内存泄漏"><a href="#Java代码中的内存泄漏" class="headerlink" title="Java代码中的内存泄漏"></a><strong>Java代码中的内存泄漏</strong></h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.内存泄漏的原因是对象上有强引用</span><br><span class="line"><span class="number">2</span>.虽然Java程序运行完后,内存会回收,但应让对象尽早被回收</span><br><span class="line"><span class="number">3</span>.出现内存泄漏后,会导致Stop The World和OOM异常</span><br></pre></td></tr></table></figure>
<h1 id="finalize方法"><a href="#finalize方法" class="headerlink" title="finalize方法"></a><strong>finalize方法</strong></h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.Object类中的方法,任何类都可以重写该方法</span><br><span class="line"><span class="number">2</span>.当JVM通过根可达算法,判断某对象可以被回收后,会判断该类是否重写了finalize方法,如果没有,将直接回收;如果重写了finalize方法,会将该对象放入F-Queue队列中,有线程专门遍历并执行该类的finalize方法,执行后再判断该类是否可被回收,如是则将该对象回收</span><br><span class="line"><span class="number">3</span>.可以在finalize方法中编写类回收前所需的动作,但是如果编写不当,会造成对象无法回收,从而引发内存泄漏问题,所以如果没有特殊理由,不建议重写finalize方法</span><br></pre></td></tr></table></figure>
<h2 id="代码展示"><a href="#代码展示" class="headerlink" title="代码展示"></a><strong>代码展示</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemoryOptimizationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MemoryOptimizationTest memoryOptimizationTest;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"进入finalize方法中"</span>);</span><br><span class="line">        <span class="comment">/* 加强引用 */</span></span><br><span class="line">        memoryOptimizationTest = <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        memoryOptimizationTest = <span class="keyword">new</span> MemoryOptimizationTest();</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* 去除强引用 */</span></span><br><span class="line">        memoryOptimizationTest = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* 垃圾回收 */</span></span><br><span class="line">        System.gc();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (memoryOptimizationTest == <span class="keyword">null</span>) System.out.println(<span class="string">"失去"</span>);</span><br><span class="line">        <span class="keyword">else</span> System.out.println(<span class="string">"活着"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="打印展示"><a href="#打印展示" class="headerlink" title="打印展示"></a><strong>打印展示</strong></h2><p><img src="/123/" class="lazyload" data-src="https://img-blog.csdnimg.cn/2021052716134047.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2dhbzU4MDUxMjM=,size_16,color_FFFFFF,t_70"  alt="finalize方法"></p>
<h1 id="String"><a href="#String" class="headerlink" title="String"></a><strong>String</strong></h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.String指向的内存空间中的值是不可变的,当String变量存储的值被改变后,并不会更改内存中存储的值,而是指向新的内存空间,由此就会产生内存碎片</span><br><span class="line"><span class="number">2</span>.频繁的对String进行修改,会造成大量的内存碎片,增加JVM的负担;建议使用StringBuffer和StringBuilder进行操作</span><br><span class="line">	String: 字符串常量</span><br><span class="line">	StringBuffer: 线程安全的字符串变量</span><br><span class="line">	StringBuilder: 非线程安全的字符串变量</span><br></pre></td></tr></table></figure>
<h2 id="观察String的不可变特性"><a href="#观察String的不可变特性" class="headerlink" title="观察String的不可变特性"></a><strong>观察String的不可变特性</strong></h2><h3 id="代码展示-1"><a href="#代码展示-1" class="headerlink" title="代码展示"></a><strong>代码展示</strong></h3><blockquote>
<p>hashcode方法返回的是对象的哈希码值，通过哈希码值可以快速的查找到对象所在的内存地址，而String的值是不可变的，所以当String被重新赋值时，哈希码值也应该被修改</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String a = <span class="string">"123"</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"存储123的变量a的hash值: "</span> + a.hashCode());</span><br><span class="line"></span><br><span class="line">        a = <span class="string">"456"</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"修改变量a的值为456后的hash值: "</span> + a.hashCode());</span><br><span class="line"></span><br><span class="line">        a = <span class="string">"456"</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"在变量a的值为456的情况下再次将变量啊的值修改成456后的hash值: "</span> + a.hashCode());</span><br><span class="line"></span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line">        sb.append(<span class="string">"123456789"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"第一次拼接字符串时sb的hash值: "</span> + sb.hashCode());</span><br><span class="line"></span><br><span class="line">        sb.append(<span class="string">"asd"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"第二次拼接字符串时sb的hash值: "</span> + sb.hashCode());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="图片展示"><a href="#图片展示" class="headerlink" title="图片展示"></a><strong>图片展示</strong></h3><p><img src="/123/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20210526162415520.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2dhbzU4MDUxMjM=,size_16,color_FFFFFF,t_70"  alt="hashcode"></p>
<h2 id="通过String观察常量和变量"><a href="#通过String观察常量和变量" class="headerlink" title="通过String观察常量和变量"></a><strong>通过String观察常量和变量</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.equals比较值, ==比较地址值</span><br><span class="line"><span class="number">2</span>.<span class="keyword">new</span>创建的是变量</span><br><span class="line"><span class="number">3</span>.常量可以共享内存,变量不会</span><br><span class="line"><span class="number">4</span>.常量连接是常量,有变量参与是变量</span><br><span class="line"><span class="number">5</span>.被<span class="keyword">final</span>修饰的变量会成为常量</span><br></pre></td></tr></table></figure>
<h3 id="代码展示-2"><a href="#代码展示-2" class="headerlink" title="代码展示"></a><strong>代码展示</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> String s = <span class="string">"a"</span>;</span><br><span class="line"></span><br><span class="line">        String a = <span class="string">"abc"</span>,</span><br><span class="line">                b = <span class="string">"abc"</span>,</span><br><span class="line">                c = <span class="keyword">new</span> String(<span class="string">"abc"</span>),</span><br><span class="line">                d = <span class="string">"a"</span> + <span class="string">"bc"</span>,</span><br><span class="line">                e = <span class="string">"a"</span>,</span><br><span class="line">                f = e + <span class="string">"bc"</span>,</span><br><span class="line">                g = s + <span class="string">"bc"</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"----- 常量判断 -----"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"a.equals(b) : "</span> + a.equals(b));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"a == b : "</span> + (a == b));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"----- new对象判断 -----"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"a.equals(c) : "</span> + a.equals(c));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"a == c : "</span> + (a == c));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"----- 拼接常量判断 -----"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"a.equals(d) : "</span> + a.equals(d));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"a == d : "</span> + (a == d));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"----- 常量变量拼接判断 -----"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"a.equals(f) : "</span> + a.equals(f));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"a == f : "</span> + (a == f));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"----- 拼接final修饰判断 -----"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"a.equals(g) : "</span> + a.equals(g));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"a == g : "</span> + (a == g));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="打印展示-1"><a href="#打印展示-1" class="headerlink" title="打印展示"></a><strong>打印展示</strong></h3><p><img src="/123/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20210526151806567.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2dhbzU4MDUxMjM=,size_16,color_FFFFFF,t_70"  alt="常量变量判断"></p>
<h2 id="常量与变量的存储位置"><a href="#常量与变量的存储位置" class="headerlink" title="常量与变量的存储位置"></a><strong>常量与变量的存储位置</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.<span class="keyword">new</span>创建的变量存储在堆中</span><br><span class="line"><span class="number">2</span>.常量存储在常量池中,相同的值可以共享内存</span><br><span class="line"><span class="number">3</span>.被<span class="keyword">final</span>修饰的变量是常量,存储在常量池中</span><br><span class="line"><span class="number">4</span>.JVM内存优化,是针对堆区</span><br></pre></td></tr></table></figure>
<h1 id="虚拟机结构"><a href="#虚拟机结构" class="headerlink" title="虚拟机结构"></a><strong>虚拟机结构</strong></h1><p><img src="/123/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20210527094927110.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2dhbzU4MDUxMjM=,size_16,color_FFFFFF,t_70"  alt="虚拟机结构"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.类装载子系统将<span class="class"><span class="keyword">class</span>文件装载,被执行引擎运行,在运行时会用到运行时数据区中的数据</span></span><br><span class="line"><span class="class">2.<span class="title">JVM</span>栈是线程私有的</span></span><br><span class="line"><span class="class">3.堆区中存放<span class="title">new</span>创建的对象,<span class="title">JDK1</span>.8中,常量池和静态变量存放在堆区中</span></span><br><span class="line"><span class="class">4.元数据区在本地内存中存放</span></span><br></pre></td></tr></table></figure>
<h1 id="垃圾回收时的分代管理"><a href="#垃圾回收时的分代管理" class="headerlink" title="垃圾回收时的分代管理"></a><strong>垃圾回收时的分代管理</strong></h1><p><img src="/123/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20210527100111990.png"  alt="年轻代和年老代"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JDK1<span class="number">.8</span>中,元数据区替代持久代</span><br><span class="line"><span class="number">2</span>.类的信息和编译后的代码数据等放在元数据区</span><br><span class="line"><span class="number">3</span>.JVM内存调优是针对堆区,再进一步是针对年轻代和年老代</span><br></pre></td></tr></table></figure>
<h2 id="内存回收流程"><a href="#内存回收流程" class="headerlink" title="内存回收流程"></a><strong>内存回收流程</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span>对象时先在Eden区申请内存,如果申请不到,对Eden区进行Minor GC,如果再申请不到,会将Eden区中存活的内存移到幸存区,并对Eden区再次进行Minor GC,如果Eden区分配空间再不满足,就把幸存区中的内容移动到年老区,如果年老区内容也满了就会进行Full GC,再分配不到,报OOM异常</span><br></pre></td></tr></table></figure>
<h1 id="Minor-GC和Full-GC"><a href="#Minor-GC和Full-GC" class="headerlink" title="Minor GC和Full GC"></a><strong>Minor GC和Full GC</strong></h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.Minor GC: 轻量级GC</span><br><span class="line"><span class="number">2</span>.Full GC: 重量级GC</span><br><span class="line"><span class="number">2</span>.System.gc方法会触发Full GC,System.gc方法是告诉JVM可以进行回收,一般会在之后很短时间内执行</span><br><span class="line"><span class="number">3</span>.能通过java命令分配堆空间的运行策略,比如能设置年轻代和年老代的比例,如果JVM监控到上次GC后,运行策略发生变化,会触发Full GC</span><br></pre></td></tr></table></figure>
<h2 id="判断对象可以被回收的标准"><a href="#判断对象可以被回收的标准" class="headerlink" title="判断对象可以被回收的标准"></a><strong>判断对象可以被回收的标准</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.对象上没有强引用就可以被回收,<span class="keyword">new</span>创建的叫强引用,若对象是软引用或弱引用就可能会被回收</span><br><span class="line"><span class="number">2</span>.JDK早期版本用的是引用计数法,当一个对象加一个强引用时,引用计数加<span class="number">1</span>,去掉一个强引用时,引用计数减<span class="number">1</span>,对象上没有引用计数时,就能够被回收;但是引用计数法会导致循环依赖的对象无法被回收,后来就将使用的引用计数法改为了根可达算法</span><br></pre></td></tr></table></figure>
<h2 id="可作为根可达算法的对象"><a href="#可作为根可达算法的对象" class="headerlink" title="可作为根可达算法的对象"></a><strong>可作为根可达算法的对象</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.JVM栈中引用的对象</span><br><span class="line"><span class="number">2</span>.本地方法栈中引用的对象</span><br><span class="line"><span class="number">3</span>.静态变量和常量所引用的对象</span><br></pre></td></tr></table></figure>
<h1 id="强引用、弱引用、软引用"><a href="#强引用、弱引用、软引用" class="headerlink" title="强引用、弱引用、软引用"></a><strong>强引用、弱引用、软引用</strong></h1><h2 id="定义强引用、软引用和弱引用的方式"><a href="#定义强引用、软引用和弱引用的方式" class="headerlink" title="定义强引用、软引用和弱引用的方式"></a><strong>定义强引用、软引用和弱引用的方式</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.<span class="keyword">new</span>出来的是强引用</span><br><span class="line"><span class="number">2</span>.通过SoftReference对象可以定义软引用</span><br><span class="line"><span class="number">3</span>.通过WeakReference对象可以定义弱引用,WeakHashMap就是基于弱引用的Map集合</span><br></pre></td></tr></table></figure>
<h2 id="软引用和弱引用的回收时机"><a href="#软引用和弱引用的回收时机" class="headerlink" title="软引用和弱引用的回收时机"></a><strong>软引用和弱引用的回收时机</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.对象上有强引用,则不会被回收</span><br><span class="line"><span class="number">2</span>.如果一个对象只有软引用,且当前虚拟机堆内存空间足够,不会回收,反之会回收</span><br><span class="line"><span class="number">3</span>.JVM一旦发现某块内存上只有弱引用,不管当前内存空间是否足够,都会回收</span><br></pre></td></tr></table></figure>
<h3 id="代码展示-3"><a href="#代码展示-3" class="headerlink" title="代码展示"></a><strong>代码展示</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.ref.SoftReference;</span><br><span class="line"><span class="keyword">import</span> java.lang.ref.WeakReference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemoryOptimizationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 强引用 */</span></span><br><span class="line">        String s = <span class="keyword">new</span> String(<span class="string">"123"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 软引用 */</span></span><br><span class="line">        SoftReference&lt;String&gt; stringSoftReference = <span class="keyword">new</span> SoftReference&lt;&gt;(s);</span><br><span class="line"></span><br><span class="line">        s = <span class="keyword">null</span> <span class="comment">/* 去掉强引用 */</span>;</span><br><span class="line"></span><br><span class="line">        System.gc() <span class="comment">/* 垃圾回收器进行回收 */</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(stringSoftReference.get());</span><br><span class="line"></span><br><span class="line">        s = <span class="keyword">new</span> String(<span class="string">"123"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 弱引用 */</span></span><br><span class="line">        WeakReference&lt;String&gt; weakReference = <span class="keyword">new</span> WeakReference&lt;&gt;(s);</span><br><span class="line"></span><br><span class="line">        s = <span class="keyword">null</span> <span class="comment">/* 去掉强引用 */</span>;</span><br><span class="line"></span><br><span class="line">        System.gc() <span class="comment">/* 垃圾回收器进行回收 */</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(weakReference.get());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="WeakHashMap"><a href="#WeakHashMap" class="headerlink" title="WeakHashMap"></a><strong>WeakHashMap</strong></h2><h3 id="打印展示-2"><a href="#打印展示-2" class="headerlink" title="打印展示"></a><strong>打印展示</strong></h3><p><img src="/123/" class="lazyload" data-src="https://img-blog.csdnimg.cn/2021060111122088.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2dhbzU4MDUxMjM=,size_16,color_FFFFFF,t_70"  alt="软引用和弱引用的回收时机"></p>
<h3 id="代码展示-4"><a href="#代码展示-4" class="headerlink" title="代码展示"></a><strong>代码展示</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.WeakHashMap;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemoryOptimizationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String a = <span class="keyword">new</span> String(<span class="string">"a"</span>),</span><br><span class="line">                b = <span class="keyword">new</span> String(<span class="string">"b"</span>);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;(),</span><br><span class="line">                weakHashMap = <span class="keyword">new</span> WeakHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        map.put(a, <span class="string">"aaa"</span>) <span class="comment">/* a上有String和HashMap的强引用 */</span>;</span><br><span class="line">        map.put(b, <span class="string">"bbb"</span>) <span class="comment">/* b上有String和HashMap的强引用 */</span>;</span><br><span class="line"></span><br><span class="line">        weakHashMap.put(a, <span class="string">"aaa"</span>) <span class="comment">/* 再给a加上弱引用 */</span>;</span><br><span class="line">        weakHashMap.put(b, <span class="string">"bbb"</span>) <span class="comment">/* 再给b加上弱引用 */</span>;</span><br><span class="line"></span><br><span class="line">        map.remove(a) <span class="comment">/* 撤销a上HashMap的强引用 */</span>;</span><br><span class="line"></span><br><span class="line">        a = <span class="keyword">null</span> <span class="comment">/* 撤销a上String的强引用,a上只剩weakHashMap的弱引用 */</span>;</span><br><span class="line">        b = <span class="keyword">null</span> <span class="comment">/* 撤销b上String的强引用,b上还剩HashMap的强引用和weakHashMap的弱引用 */</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* a上没有强引用,只有弱引用,会被自动回收 */</span></span><br><span class="line">        System.gc() <span class="comment">/* 垃圾回收*/</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; next : map.entrySet()) System.out.println(<span class="string">"HashMap \t"</span> + next.getKey() + <span class="string">" : "</span> + next.getValue());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; next : weakHashMap.entrySet()) System.out.println(<span class="string">"WeakHashMap "</span> + next.getKey() + <span class="string">" : "</span> + next.getValue());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="打印展示-3"><a href="#打印展示-3" class="headerlink" title="打印展示"></a><strong>打印展示</strong></h3><p><img src="/123/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20210601140429904.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2dhbzU4MDUxMjM=,size_16,color_FFFFFF,t_70"  alt="强弱引用"></p>
<h1 id="内部匿名类形参"><a href="#内部匿名类形参" class="headerlink" title="内部匿名类形参"></a><strong>内部匿名类形参</strong></h1><h2 id="JDK1-7及之前版本"><a href="#JDK1-7及之前版本" class="headerlink" title="JDK1.7及之前版本"></a><strong>JDK1.7及之前版本</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.内部匿名类,形参要加<span class="keyword">final</span>,否则会报语法错误</span><br><span class="line"><span class="number">2</span>.内部类和外部类是平行的,没有隶属关系</span><br><span class="line"><span class="number">3</span>.外部类有可能会先于内部类回收,如果不加<span class="keyword">final</span>,参数会被回收,从而导致内部类无法使用;如果加<span class="keyword">final</span>,会以常量的方式存储,而不是存在堆中,所以外部类回收后,改参数照样会存在</span><br></pre></td></tr></table></figure>
<h2 id="JDK1-8版本"><a href="#JDK1-8版本" class="headerlink" title="JDK1.8版本"></a><strong>JDK1.8版本</strong></h2><p><img src="/123/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20210601160548985.gif#pic_center"  alt="隐式内部类"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">不需要显式地加<span class="keyword">final</span>,但依然会被当常量管理,无法将其指向新的内存空间</span><br></pre></td></tr></table></figure>
<h1 id="优化措施"><a href="#优化措施" class="headerlink" title="优化措施"></a><strong>优化措施</strong></h1><h2 id="代码中的优化措施"><a href="#代码中的优化措施" class="headerlink" title="代码中的优化措施"></a><strong>代码中的优化措施</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.没有特殊理由,不要重写finalize方法</span><br><span class="line"><span class="number">2</span>.不要频繁的操作String对象,尤其是在循环与多线程中;如需频繁修改,可以使用StringBuilder和StringBuffer</span><br><span class="line"><span class="number">3</span>.在<span class="keyword">finally</span>从句中释放IO、数据库或网络连接等的物理对象以确保对象能在各种场景中正确地关闭</span><br><span class="line"><span class="number">4</span>.集合对象要及时clean</span><br><span class="line"><span class="number">5</span>.对象用完后可以在<span class="keyword">finally</span>从句中设置成<span class="keyword">null</span></span><br><span class="line"><span class="number">6</span>.在适当的场景中合理的使用软引用和弱引用</span><br></pre></td></tr></table></figure>
<h2 id="命令的优化措施"><a href="#命令的优化措施" class="headerlink" title="命令的优化措施"></a><strong>命令的优化措施</strong></h2><p><img src="/123/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20210527165139200.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2dhbzU4MDUxMjM=,size_16,color_FFFFFF,t_70"  alt="命令调优"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">合理调整JVM参数,但是调整参数需要慎重,且优先考虑代码级别的优化措施</span><br></pre></td></tr></table></figure></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">123</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gao5805123.github.io/123/2021/06/29/Java%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96/">https://gao5805123.github.io/123/2021/06/29/Java%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gao5805123.github.io/123" target="_blank">123</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/123/tags/Java/">Java</a></div><div class="post_share"><div class="social-share" data-image="https://img-blog.csdnimg.cn/20210629111641657.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/123/img/WeChat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/123/img/PayTreasure.jpg" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/123/2021/06/29/%E5%AE%9A%E4%BD%8D%E5%92%8C%E6%8E%92%E6%9F%A5OOM%E6%B5%81%E7%A8%8B/"><img class="prev_cover lazyload" data-src="https://img-blog.csdnimg.cn/20210629111641657.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">定位和排查OOM流程</div></div></a></div><div class="next-post pull_right"><a href="/123/2021/06/29/ConcurrentHashMap/"><img class="next_cover lazyload" data-src="https://img-blog.csdnimg.cn/20210629110659535.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ConcurrentHashMap</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/123/2021/06/29/ConcurrentHashMap/" title="ConcurrentHashMap"><img class="relatedPosts_cover lazyload"data-src="https://img-blog.csdnimg.cn/20210629110659535.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-06-29</div><div class="relatedPosts_title">ConcurrentHashMap</div></div></a></div><div class="relatedPosts_item"><a href="/123/2020/05/04/BeanCreationException和IllegalStateException Ambiguous mapping. Cannot map 'brandController' method/" title="org.springframework.beans.factory.BeanCreationException Error creating bean with name requestMappingHandlerMapping defined in class path resource [org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration$EnableWebMvcConfiguration.class] Invocation of init method failed; nested exception is java.lang.IllegalStateException Ambiguous mapping. Cannot map brandController method"><img class="relatedPosts_cover lazyload"data-src="https://img-blog.csdnimg.cn/20200504174150440.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-04</div><div class="relatedPosts_title">org.springframework.beans.factory.BeanCreationException Error creating bean with name requestMappingHandlerMapping defined in class path resource [org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration$EnableWebMvcConfiguration.class] Invocation of init method failed; nested exception is java.lang.IllegalStateException Ambiguous mapping. Cannot map brandController method</div></div></a></div><div class="relatedPosts_item"><a href="/123/2020/05/04/ClassCastException com.gao5805123.servlet.ServletDemo cannot be cast to javax.servlet.Servlet/" title="ClassCastException com.gao5805123.servlet.ServletDemo cannot be cast to javax.servlet.Servlet"><img class="relatedPosts_cover lazyload"data-src="https://img-blog.csdnimg.cn/20200504144626989.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-04</div><div class="relatedPosts_title">ClassCastException com.gao5805123.servlet.ServletDemo cannot be cast to javax.servlet.Servlet</div></div></a></div><div class="relatedPosts_item"><a href="/123/2020/05/04/CannotGetJdbcConnectionException、SQLException和com.mysql.cj.exceptions.InvalidConnectionAttributeException The server time zone value is unrecognized or represents more than one time zone/" title="CannotGetJdbcConnectionException、SQLException和InvalidConnectionAttributeException The server time zone value is unrecognized or represents more than one time zone. You must configure either the server or JDBC driver (via the serverTimezone configuration property) to use a more specifc time zone value if you want to utilize time zone support"><img class="relatedPosts_cover lazyload"data-src="https://img-blog.csdnimg.cn/20200514020018559.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-04</div><div class="relatedPosts_title">CannotGetJdbcConnectionException、SQLException和InvalidConnectionAttributeException The server time zone value is unrecognized or represents more than one time zone. You must configure either the server or JDBC driver (via the serverTimezone configuration property) to use a more specifc time zone value if you want to utilize time zone support</div></div></a></div><div class="relatedPosts_item"><a href="/123/2020/05/03/ConnectExceptionConnection refused connect  & TransportCannotexecute request on any known server/" title="ConnectExceptionConnection refused connect  & TransportCannotexecute request on any known server"><img class="relatedPosts_cover lazyload"data-src="https://img-blog.csdnimg.cn/2020050316460777.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-03</div><div class="relatedPosts_title">ConnectExceptionConnection refused connect  & TransportCannotexecute request on any known server</div></div></a></div><div class="relatedPosts_item"><a href="/123/2020/05/04/CommunicationsException Communications link failure和java.net.ConnectException Connection refused connect/" title="CommunicationsException Communications link failure和java.net.ConnectException Connection refused connect"><img class="relatedPosts_cover lazyload"data-src="https://img-blog.csdnimg.cn/20200504180214734.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-04</div><div class="relatedPosts_title">CommunicationsException Communications link failure和java.net.ConnectException Connection refused connect</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By 123</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">感谢你的关注</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/123/js/utils.js"></script><script src="/123/js/main.js"></script><script src="/123/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/123/js/third-party/ClickShowText.js"></script><script src="/123/js/search/local-search.js"></script><script src="/123/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/123/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":145,"height":315},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"dialog":{"enable":true,"hitokoto":true},"log":false});</script></body></html>