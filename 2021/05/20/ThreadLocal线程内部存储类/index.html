<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ThreadLocal线程内部存储类 | 123</title><meta name="description" content="ThreadLocal的使用代码展示1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public class ThreadLocalTest implements Runnable &amp;#123;    private final ThreadLocal&lt;Integer&amp;g"><meta name="keywords" content="Java"><meta name="author" content="123"><meta name="copyright" content="123"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/123/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="ThreadLocal线程内部存储类"><meta name="twitter:description" content="ThreadLocal的使用代码展示1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public class ThreadLocalTest implements Runnable &amp;#123;    private final ThreadLocal&lt;Integer&amp;g"><meta name="twitter:image" content="https://img-blog.csdnimg.cn/20210521092139964.png"><meta property="og:type" content="article"><meta property="og:title" content="ThreadLocal线程内部存储类"><meta property="og:url" content="https://gao5805123.github.io/123/2021/05/20/ThreadLocal%E7%BA%BF%E7%A8%8B%E5%86%85%E9%83%A8%E5%AD%98%E5%82%A8%E7%B1%BB/"><meta property="og:site_name" content="123"><meta property="og:description" content="ThreadLocal的使用代码展示1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public class ThreadLocalTest implements Runnable &amp;#123;    private final ThreadLocal&lt;Integer&amp;g"><meta property="og:image" content="https://img-blog.csdnimg.cn/20210521092139964.png"><meta property="article:published_time" content="2021-05-20T08:41:45.000Z"><meta property="article:modified_time" content="2021-05-21T01:21:58.141Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/123/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://gao5805123.github.io/123/2021/05/20/ThreadLocal%E7%BA%BF%E7%A8%8B%E5%86%85%E9%83%A8%E5%AD%98%E5%82%A8%E7%B1%BB/"><link rel="prev" title="ThreadPoolExecutor线程池" href="https://gao5805123.github.io/123/2021/05/21/ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0/"><link rel="next" title="线程锁" href="https://gao5805123.github.io/123/2021/05/20/%E7%BA%BF%E7%A8%8B%E9%94%81/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/123/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: {"text":"123,邪丶魔狱","fontSize":"15px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="google-site-verification" content="pfcRZO1Gb4pmhedTsfidXjiu4Q25HFYON7GMwAXxEYQ" /><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/123/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/123/archives/"><div class="headline">文章</div><div class="length_num">188</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/123/tags/"><div class="headline">标签</div><div class="length_num">12</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/123/categories/"><div class="headline">分类</div><div class="length_num">12</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/123/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/123/archives/"><i class="fa-fw fa fa-archive"></i><span> 档案</span></a></div><div class="menus_item"><a class="site-page" href="/123/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/123/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/123/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/123/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/123/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ThreadLocal的使用"><span class="toc-number">1.</span> <span class="toc-text">ThreadLocal的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#代码展示"><span class="toc-number">1.1.</span> <span class="toc-text">代码展示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#打印展示"><span class="toc-number">1.2.</span> <span class="toc-text">打印展示</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#内部数据结构"><span class="toc-number">2.</span> <span class="toc-text">内部数据结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#set方法源码解析"><span class="toc-number">3.</span> <span class="toc-text">set方法源码解析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#get方法源码"><span class="toc-number">4.</span> <span class="toc-text">get方法源码</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#可能会导致的内存泄漏"><span class="toc-number">5.</span> <span class="toc-text">可能会导致的内存泄漏</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#问题原因"><span class="toc-number">5.1.</span> <span class="toc-text">问题原因</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解决方法"><span class="toc-number">5.2.</span> <span class="toc-text">解决方法</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://img-blog.csdnimg.cn/20210521092139964.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/123/">123</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/123/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/123/archives/"><i class="fa-fw fa fa-archive"></i><span> 档案</span></a></div><div class="menus_item"><a class="site-page" href="/123/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/123/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/123/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/123/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/123/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">ThreadLocal线程内部存储类</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2021-05-20 16:41:45"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2021-05-20</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2021-05-21 09:21:58"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2021-05-21</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/123/categories/Java/">Java</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h1 id="ThreadLocal的使用"><a href="#ThreadLocal的使用" class="headerlink" title="ThreadLocal的使用"></a><strong>ThreadLocal的使用</strong></h1><h2 id="代码展示"><a href="#代码展示" class="headerlink" title="代码展示"></a><strong>代码展示</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocalTest</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ThreadLocal&lt;Integer&gt; local = ThreadLocal.withInitial(() -&gt; <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; stringLocal = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        local.set(local.get() + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> local.get() + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">setStringLocal</span><span class="params">(String threadName)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            stringLocal.set(threadName);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> stringLocal.get();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            stringLocal.remove();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            System.out.println(add() + <span class="string">" --- "</span> + setStringLocal(Thread.currentThread().getName()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ThreadLocalTest threadLocalTest = <span class="keyword">new</span> ThreadLocalTest();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(threadLocalTest).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(threadLocalTest).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="打印展示"><a href="#打印展示" class="headerlink" title="打印展示"></a><strong>打印展示</strong></h2><p><img src="/123/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20210521091559580.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2dhbzU4MDUxMjM=,size_16,color_FFFFFF,t_70"  alt="ThreadLocal的使用"></p>
<h1 id="内部数据结构"><a href="#内部数据结构" class="headerlink" title="内部数据结构"></a><strong>内部数据结构</strong></h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一个线程类中有一个ThreadLocalMap,ThreadLocalMap中可以有多个Entry,每个Entry都存储了一个ThreadLocal本地变量</span><br></pre></td></tr></table></figure>
<h1 id="set方法源码解析"><a href="#set方法源码解析" class="headerlink" title="set方法源码解析"></a><strong>set方法源码解析</strong></h1><p><img src="/123/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20210520144949375.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2dhbzU4MDUxMjM=,size_16,color_FFFFFF,t_70"  alt="set方法源码"><br><img src="/123/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20210520161254307.png"  alt="getMap"><br><img src="/123/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20210520160311592.png"  alt="创建ThreadLocalMap对象"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.调用时需要传递一个参数</span><br><span class="line"><span class="number">2</span>.进入set方法后,首先获取一个线程对象,使用getMap方法获取当中的ThreadLocalMap对象</span><br><span class="line"><span class="number">3</span>.判断ThreadLocalMap对象是否为空,不为空就用ThreadLocal对象作为Key,值作为Value存储到ThreadLocalMap对象中;为空则直接用当前线程和传递的值创建ThreadLocalMap对象</span><br></pre></td></tr></table></figure>
<h1 id="get方法源码"><a href="#get方法源码" class="headerlink" title="get方法源码"></a><strong>get方法源码</strong></h1><p><img src="/123/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20210520160914625.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2dhbzU4MDUxMjM=,size_16,color_FFFFFF,t_70"  alt="get方法源码"><br><img src="/123/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20210520163346930.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2dhbzU4MDUxMjM=,size_16,color_FFFFFF,t_70"  alt="setInitialValue源码"><br><img src="/123/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20210520163423774.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2dhbzU4MDUxMjM=,size_16,color_FFFFFF,t_70"  alt="initialValue源码"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.进入get方法后,首先同set方法一样获取一个线程对象,使用getMap方法获取当中的ThreadLocalMap对象</span><br><span class="line"><span class="number">2</span>.判断ThreadLocalMap对象是否为空,不为空就用ThreadLocal对象作为键获取Entry对象,然后再判断Entry对象是否为空,不为空就直接获取value值,将其强转成对应数据类型的数据返回;若ThreadLocalMap对象为空,则调用setInitialValue方法返回,setInitialValue方法中首先调用了initialValue方法,initialValue方法中的返回值为<span class="keyword">null</span>,再回到setInitialValue方法中往下走就同set方法一致了,但走到最后一步会将<span class="keyword">null</span>返回</span><br></pre></td></tr></table></figure>
<h1 id="可能会导致的内存泄漏"><a href="#可能会导致的内存泄漏" class="headerlink" title="可能会导致的内存泄漏"></a><strong>可能会导致的内存泄漏</strong></h1><h2 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a><strong>问题原因</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.在ThreadLocal中保存值时,会放入Entry对象</span><br><span class="line"><span class="number">2</span>.Entry是基于弱引用的,若创建的ThreadLocal的线程终止,Entry对象将会被回收</span><br><span class="line"><span class="number">3</span>.但若是创建的ThreadLocal的线程一直持续运行,那当中的value就可能无法回收</span><br></pre></td></tr></table></figure>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a><strong>解决方法</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">合理使用ThreadLocal对象,并及时的对其使用remove方法进行资源释放</span><br></pre></td></tr></table></figure></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">123</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gao5805123.github.io/123/2021/05/20/ThreadLocal%E7%BA%BF%E7%A8%8B%E5%86%85%E9%83%A8%E5%AD%98%E5%82%A8%E7%B1%BB/">https://gao5805123.github.io/123/2021/05/20/ThreadLocal%E7%BA%BF%E7%A8%8B%E5%86%85%E9%83%A8%E5%AD%98%E5%82%A8%E7%B1%BB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gao5805123.github.io/123" target="_blank">123</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/123/tags/Java/">Java</a></div><div class="post_share"><div class="social-share" data-image="https://img-blog.csdnimg.cn/20210629111641657.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/123/img/WeChat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/123/img/PayTreasure.jpg" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/123/2021/05/21/ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0/"><img class="prev_cover lazyload" data-src="https://img-blog.csdnimg.cn/20210521143642684.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ThreadPoolExecutor线程池</div></div></a></div><div class="next-post pull_right"><a href="/123/2021/05/20/%E7%BA%BF%E7%A8%8B%E9%94%81/"><img class="next_cover lazyload" data-src="https://img-blog.csdnimg.cn/20210520113540175.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">线程锁</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/123/2020/05/04/CommunicationsException Communications link failure和java.net.ConnectException Connection refused connect/" title="CommunicationsException Communications link failure和java.net.ConnectException Connection refused connect"><img class="relatedPosts_cover lazyload"data-src="https://img-blog.csdnimg.cn/20200504180214734.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-04</div><div class="relatedPosts_title">CommunicationsException Communications link failure和java.net.ConnectException Connection refused connect</div></div></a></div><div class="relatedPosts_item"><a href="/123/2021/06/29/ConcurrentHashMap/" title="ConcurrentHashMap"><img class="relatedPosts_cover lazyload"data-src="https://img-blog.csdnimg.cn/20210629110659535.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-06-29</div><div class="relatedPosts_title">ConcurrentHashMap</div></div></a></div><div class="relatedPosts_item"><a href="/123/2020/05/04/ClassCastException com.gao5805123.servlet.ServletDemo cannot be cast to javax.servlet.Servlet/" title="ClassCastException com.gao5805123.servlet.ServletDemo cannot be cast to javax.servlet.Servlet"><img class="relatedPosts_cover lazyload"data-src="https://img-blog.csdnimg.cn/20200504144626989.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-04</div><div class="relatedPosts_title">ClassCastException com.gao5805123.servlet.ServletDemo cannot be cast to javax.servlet.Servlet</div></div></a></div><div class="relatedPosts_item"><a href="/123/2020/05/04/BeanCreationException和IllegalStateException Ambiguous mapping. Cannot map 'brandController' method/" title="org.springframework.beans.factory.BeanCreationException Error creating bean with name requestMappingHandlerMapping defined in class path resource [org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration$EnableWebMvcConfiguration.class] Invocation of init method failed; nested exception is java.lang.IllegalStateException Ambiguous mapping. Cannot map brandController method"><img class="relatedPosts_cover lazyload"data-src="https://img-blog.csdnimg.cn/20200504174150440.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-04</div><div class="relatedPosts_title">org.springframework.beans.factory.BeanCreationException Error creating bean with name requestMappingHandlerMapping defined in class path resource [org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration$EnableWebMvcConfiguration.class] Invocation of init method failed; nested exception is java.lang.IllegalStateException Ambiguous mapping. Cannot map brandController method</div></div></a></div><div class="relatedPosts_item"><a href="/123/2020/05/03/ConnectExceptionConnection refusedno further information&java.nio.channels.ClosedChannelException/" title="ConnectExceptionConnection refusedno further information和java.nio.channels.ClosedChannelException"><img class="relatedPosts_cover lazyload"data-src="https://img-blog.csdnimg.cn/20200514014118248.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-03</div><div class="relatedPosts_title">ConnectExceptionConnection refusedno further information和java.nio.channels.ClosedChannelException</div></div></a></div><div class="relatedPosts_item"><a href="/123/2020/05/04/CannotGetJdbcConnectionException、SQLException和com.mysql.cj.exceptions.InvalidConnectionAttributeException The server time zone value is unrecognized or represents more than one time zone/" title="CannotGetJdbcConnectionException、SQLException和InvalidConnectionAttributeException The server time zone value is unrecognized or represents more than one time zone. You must configure either the server or JDBC driver (via the serverTimezone configuration property) to use a more specifc time zone value if you want to utilize time zone support"><img class="relatedPosts_cover lazyload"data-src="https://img-blog.csdnimg.cn/20200514020018559.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-04</div><div class="relatedPosts_title">CannotGetJdbcConnectionException、SQLException和InvalidConnectionAttributeException The server time zone value is unrecognized or represents more than one time zone. You must configure either the server or JDBC driver (via the serverTimezone configuration property) to use a more specifc time zone value if you want to utilize time zone support</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By 123</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">感谢你的关注</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/123/js/utils.js"></script><script src="/123/js/main.js"></script><script src="/123/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/123/js/third-party/ClickShowText.js"></script><script src="/123/js/search/local-search.js"></script><script src="/123/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/123/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":145,"height":315},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"dialog":{"enable":true,"hitokoto":true},"log":false});</script></body></html>